# Resolve Dispute Spell
# Arbiter resolves a disputed escrow
#
# Variables:
#   - escrow_app_id: Escrow app identity
#   - escrow_app_vk: Escrow app verification key
#   - token_id: Token in escrow
#   - token_vk: Token verification key
#   - escrow_utxo: UTXO containing the disputed escrow
#   - addr_winner: Address of the winner (depositor or recipient)
#   - arbiter_signature: Arbiter's signature

version: 8

apps:
  $ESCROW: n/${escrow_app_id}/${escrow_app_vk}
  $TOKEN: t/${token_id}/${token_vk}

public_inputs:
  $ESCROW: "resolve"

private_inputs:
  $ESCROW:
    preimage: ""
    signature: ${arbiter_signature}
    signer_pubkey: ${arbiter_pubkey}

ins:
  # Disputed escrow
  - utxo_id: ${escrow_utxo}
    charms:
      $ESCROW:
        escrow_id: ${escrow_id}
        depositor_pubkey: ${depositor_pubkey}
        recipient_pubkey: ${recipient_pubkey}
        arbiter_pubkey: ${arbiter_pubkey}
        escrow_type: 2
        held_app_id: ${token_id}
        held_amount: ${amount}
        release_hash: ${release_hash}
        expiry_height: ${expiry_height}
        status: 4
        created_at: ${created_at}
        order_id: ${order_id}
      $TOKEN: ${amount}

outs:
  # Tokens go to winner (decided by arbiter)
  - address: ${addr_winner}
    charms:
      $TOKEN: ${amount}

